generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             Int              @id @default(autoincrement())
  username       String           @unique
  email          String           @unique
  password       String
  avatar         String?
  bio            String?
  role           Role             @default(USER)
  createdAt      DateTime         @default(now())
  timezone       String           @default("UTC")
  
  projects       Project[]
  sprints        Sprint[]
  writingPlan    WritingPlan?
  weeklyProgress WeeklyProgress[]
}

model Project {
  id          Int      @id @default(autoincrement())
  userId      Int
  title       String   // "The Dragon's Oath"
  description String?  // "Fantasy trilogy, book 1"
  link        String   // Google Docs link
  createdAt   DateTime @default(now())
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
}

model Sprint {
  id           Int       @id @default(autoincrement())
  userId       Int
  duration     Int       // minutes
  checkin      String?
  checkout     String?
  wordsWritten Int       @default(0) // User reports this
  startedAt    DateTime  @default(now())
  completedAt  DateTime?
  isActive     Boolean   @default(true)
  
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([isActive])
  @@index([startedAt])
}


model WritingPlan {
  id            Int  @id @default(autoincrement())
  userId        Int  @unique
  
  // Recurring goals (template)
  mondayGoal    Int? // null = skip, 0 = no goal, 500 = word goal
  tuesdayGoal   Int?
  wednesdayGoal Int?
  thursdayGoal  Int?
  fridayGoal    Int?
  saturdayGoal  Int?
  sundayGoal    Int?


  // Preferred writing time (HH:mm)
  mondayTime    String?
  tuesdayTime   String?
  wednesdayTime String?
  thursdayTime  String?
  fridayTime    String?
  saturdayTime  String?
  sundayTime    String?
  
  user          User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
}

model WeeklyProgress {
  id              Int      @id @default(autoincrement())
  userId          Int
  weekStart       DateTime // Monday of this week (e.g., Jan 27, 2025)
  
  // Checkmarks for THIS WEEK ONLY
  mondayDone      Boolean  @default(false)
  tuesdayDone     Boolean  @default(false)
  wednesdayDone   Boolean  @default(false)
  thursdayDone    Boolean  @default(false)
  fridayDone      Boolean  @default(false)
  saturdayDone    Boolean  @default(false)
  sundayDone      Boolean  @default(false)
  
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([userId, weekStart]) // One record per user per week
  @@index([userId])
  @@index([weekStart])
}

enum Role {
  USER
  ADMIN
  SPONSOR
  FOUNDING_WRITER
}